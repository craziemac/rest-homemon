{
  "name": "epilogue",
  "description": "Create REST resources and controllers with Sequelize and Express or Restify",
  "version": "0.3.2",
  "author": {
    "name": "David Chester",
    "email": "dchester@shutterstock.com"
  },
  "contributors": [
    {
      "name": "Matt Broadstone",
      "email": "mbroadst@gmail.com"
    }
  ],
  "main": "lib/",
  "scripts": {
    "jshint": "jshint ./lib ./tests",
    "mocha": "mocha --check-leaks -R spec -u exports tests/*.test.js tests/**/*.test.js",
    "coverage": "istanbul cover node_modules/.bin/_mocha -- -- tests/*.test.js tests/**/*.test.js",
    "test": "npm run-script jshint && npm run-script mocha"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/dchester/epilogue.git"
  },
  "bugs": {
    "url": "https://github.com/dchester/epilogue/issues"
  },
  "keywords": [
    "sequelize",
    "sequelizejs",
    "rest",
    "restful",
    "epilogue",
    "json",
    "api"
  ],
  "dependencies": {
    "async": "~0.2.10",
    "lodash": "~2.4.1"
  },
  "devDependencies": {
    "sqlite3": "~2.2.0",
    "request": "~2.34.0",
    "express": "3.x",
    "restify": "~2.8.3",
    "mocha": ">=1.17.0",
    "chai": ">= 1.9.0",
    "jshint": ">=2.4.2",
    "sequelize": "~1.7.0-rc6",
    "istanbul": "~0.1.45"
  },
  "readme": "[![Build Status](https://travis-ci.org/dchester/epilogue.png?branch=master)](https://travis-ci.org/dchester/epilogue)\n\n# Epilogue\n\nCreate flexible REST endpoints and controllers from [Sequelize](http://www.sequelizejs.com/) models in your [Express](http://expressjs.com/) app in Node.\n\n### Start with a model\n\nDefine your models with [Sequelize](http://www.sequelizejs.com/) on top of MySQL, Postgres, or SQLite.  Describe tables and columns and their attributes, model entity relationships, etc.\n\n```javascript\nvar User = sequelize.define(...);\n```\n\n### Create a resource\n\nLoad up `epilogue` and provide a reference to your Express app.  Then create resources, specifying a model and endpoints.\n\n```javascript\nvar rest = require('epilogue');\n\nrest.initialize({\n    app: app,\n    sequelize: sequelize\n});\n\nvar users = rest.resource({\n    model: User,\n    endpoints: ['/users', '/users/:id']\n});\n```\n\n### Controllers and endpoints\n\nOn the server we now have the following controllers and endpoints:\n\nController | Endpoint | Description\n-----------|----------|------------\nusers.create | POST /users | Create a user\nusers.list | GET /users  | Get a listing of users\nusers.read | GET /users/:id | Get details about a user\nusers.update | PUT /users/:id | Update a user\nusers.delete | DELETE /users/:id | Delete a user\n\n### Customize behavior\n\nOf course it's likely that we'll want more flexibility.  Our `users` resource has properties for each of the controller actions.  Controller actions in turn have hooks for setting and overriding behavior at each step of the request.  We have these milestones to work with: `start`, `auth`, `fetch`, `data`, `write`, `send`, and `complete`.\n\n```javascript\n// disallow deletes on users\nusers.delete.auth(function(req, res, context) {\n\tres.json(403, { error: \"can't delete a user\" });\n\tcontext.stop();\n})\n```\n\nBy default, `fetch`, `write`, and `send` milestones are defined, with the others left open.  We can set behavior for milestones directly as above, or we can add functionality before and after milestones too:\n\n```javascript\n// check the cache first\nusers.list.fetch.before(function(req, res, context) {\n\n\tvar instance = cache.get(context.criteria);\n\n\tif (instance) {\n\t\t// keep a reference to the instance and skip the fetch\n\t\tcontext.instance = instance;\n\t\tcontext.skip();\n\t} else {\n\t\t// cache miss; we continue on\n\t\tcontext.continue();\n\t}\n})\n```\n\nMilestones can also be defined in a declarative fashion, and used as middleware with any resource. For example:\n\n```javascript\n// my-middleware.js\nmodule.exports = {\n  create: {\n    fetch: function(req, res, context) {\n      // manipulate the fetch call\n      context.continue();\n    }\n  },\n  list: {\n    write: {\n      before: function(req, res, context) {\n        // modify data before writing list data\n        context.continue();\n      },\n      action: function(req, res, context) {\n        // change behavior of actually writing the data\n        context.continue();\n      },\n      after: function(req, res, context) {\n        // set some sort of flag after writing list data\n        context.continue();\n      }\n    }\n  }\n};\n\n// my-app.js\nvar rest = require('epilogue'),\n    restMiddleware = require('my-middleware');\n\nrest.initialize({\n    app: app,\n    sequelize: sequelize\n});\n\nvar users = rest.resource({\n    model: User,\n    endpoints: ['/users', '/users/:id']\n});\n\nusers.use(restMiddleware);\n```\n\nEpilogue middleware also supports bundling in extra resource configuration by specifying\nan \"extraConfiguration\" member of the middleware like so:\n\n```\n// my-middleware.js\nmodule.exports = {\n  extraConfiguration: function(resource) {\n    // support delete for plural form of a resource\n    var app = resource.app;\n    app.del(resource.endpoints.plural, function(req, res) {\n      resource.controllers.delete._control(req, res);\n    });\n  }\n};\n```\n\n### Pagination\n\nList routes support pagination via `offset` or `page` and `count` query parameters.  Find metadata about pagination and number of results in the `Content-Range` response header.\n\n```bash\n# get the third page of results\n$ curl http://localhost/users?offset=200&count=100\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Range: items 200-299/3230\n\n[\n  { name: \"James Conrad\" },\n  ...\n]\n```\n\n## Epilogue API\n\n#### initialize()\n\nSet defaults and give epilouge a reference to your express app.  Send the following parameters:\n\n> ###### app\n>\n> A reference to the Express application\n>\n> ###### base\n>\n> Prefix to prepend to resource endpoints\n>\n> ###### updateMethod\n>\n> HTTP method to use for update routes, one of `POST`, `PUT`, or `PATCH`\n\n#### resource()\n\nCreate a resource and CRUD actions given a Sequelize model and endpoints.  Accepts these parameters:\n\n> ###### model\n>\n> Reference to a Sequelize model\n>\n> ###### endpoints\n>\n> Specify endpoints as an array with two sinatra-style URL paths in plural and singular form (e.g., `['/users', '/users/:id']`).\n>\n> ###### actions\n>\n> Create only the specified list of actions for the resource.  Options include `create`, `list`, `read`, `update`, and `delete`.  Defaults to all.\n\n### Milestones\n\nMilestones provide opportunities to run custom application code at various important steps throughout the duration of the request.\n\nResources have properties for each controller action: `create`, `list`, `read`, `update`, and `delete`.  Also find a meta property `all` as a convenience for hooking into milestones across all controllers.  Each of those properties in turn has methods for setting custom behavior.\n\nFor each milestone on a given controller we accept a function to specify custom behavior.  Functions can expect three parameters: a request, a response, and a context object.\n\n#### start(f)\n\nRun at the beginning of the request.  Defaults to passthrough.\n\n#### auth(f)\n\nAuthorize the request.  Defaults to passthrough.\n\n#### fetch(f)\n\nFetch data from the database for non-create actions according to `context.criteria`, writing to `context.instance`.\n\n#### data(f)\n\nTransform the data from the database if needed.  Defaults to passthrough.\n\n#### write(f)\n\nWrite to the database for actions that write, reading from `context.attributes`.\n\n#### send(f)\n\nSend the HTTP response, headers along with the data in `context.instance`.\n\n#### complete(f)\n\nRun the specified function when the request is complete, regardless of the status of the response.\n\n### Milestones & Context\n\nMilestone methods take functions which can expect as paramaters a request, a response, and a context. Context objects contain key properties about the state of the resource at the given request milestone, as well as methods to give back control.\n\n##### context.instance\n\nInstance of a dataset fetched via the supplied model.  May be undefined for early milestones prior to the fetching of the data.\n\n##### context.attributes\n\nAttribues supplied by the request, usually in anticipation of creating or updating an instance.\n\n##### context.criteria\n\nCriteria for fetching, usually supplied by request parameters.\n\n##### context.continue()\n\nContinue with the request, on through the rest of the milestones.\n\n##### context.stop()\n\nIndicate that this should be the last milestone to be processed.\n\n##### context.skip()\n\nSkip to the next milestone, usually called from `before`.\n\n## License\n\nCopyright (C) 2012-2014 David Chester\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n",
  "readmeFilename": "README.md",
  "homepage": "https://github.com/dchester/epilogue",
  "_id": "epilogue@0.3.2",
  "dist": {
    "shasum": "c595a900f089558b43736ed659ce6cf7b07095d7"
  },
  "_from": "epilogue@",
  "_resolved": "https://registry.npmjs.org/epilogue/-/epilogue-0.3.2.tgz"
}
